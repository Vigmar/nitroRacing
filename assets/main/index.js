System.register("chunks:///_virtual/AICar.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,i,r,n,a,s,o,l,c,u,g,h;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,r=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){a=e.cclegacy,s=e._decorator,o=e.RigidBody,l=e.Vec3,c=e.Quat,u=e.PhysicsSystem,g=e.geometry,h=e.Component}],execute:function(){var d,p,y,f,A;a._RF.push({},"c3063WtAbVOE7zaj4q7k2dr","AICar",void 0);var m=s.ccclass,v=s.property;e("AICar",m("AICar")((y=t((p=function(e){function t(){for(var t,i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return t=e.call.apply(e,[this].concat(a))||this,r(t,"speed",y,n(t)),r(t,"turnSpeed",f,n(t)),r(t,"maxSteerAngle",A,n(t)),t.rigidBody=null,t.direction=new l(0,0,-1),t.steeringAngle=0,t.avoidForce=new l,t}i(t,e);var a=t.prototype;return a.start=function(){this.rigidBody=this.getComponent(o),this.setupObstacleAvoidance()},a.update=function(e){this.avoidObstacles(),this.move(e)},a.move=function(e){if(this.rigidBody){var t=this.node.forward.multiplyScalar(-1).multiplyScalar(this.speed*e);if(this.rigidBody.applyForce(t.multiplyScalar(30)),0!==this.steeringAngle){var i=new l(0,this.steeringAngle*this.turnSpeed*e,0);this.rigidBody.applyTorque(i);var r=new l(10*this.steeringAngle*e,0,0);this.rigidBody.applyForce(r)}}},a.setupObstacleAvoidance=function(){},a.avoidObstacles=function(){var e=this.node.forward.multiplyScalar(-1);this.steeringAngle=0,this.avoidForce.set(0,0,0);var t=this.node.up,i=30*Math.PI/180,r=-30*Math.PI/180,n=new c;c.fromAxisAngle(n,t,i);var a=new c;c.fromAxisAngle(a,t,r);var s=new l,o=new l;l.transformQuat(s,e,n),l.transformQuat(o,e,a),s.normalize(),o.normalize(),this.steeringAngle=0,this.raycast(s,25)&&(this.steeringAngle=-this.maxSteerAngle/2),this.raycast(o,25)&&(this.steeringAngle+=this.maxSteerAngle/2),this.raycast(e,25)&&(this.steeringAngle<0?this.steeringAngle=-this.maxSteerAngle:this.steeringAngle=this.maxSteerAngle)},a.raycast=function(e,t){if(!u.instance)return!1;var i=this.node.worldPosition,r=new g.Ray;l.copy(r.o,i),l.copy(r.d,e);var n=null;try{u.instance.raycastClosest(r,4294967295,t)&&(n=u.instance.raycastClosestResult)}catch(e){return console.error("Ошибка при вызове raycastClosest:",e),!1}if(n){n.hitPoint;return n.collider.node!==this.node}return!1},t}(h)).prototype,"speed",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),f=t(p.prototype,"turnSpeed",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),A=t(p.prototype,"maxSteerAngle",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 30}}),d=p))||d);a._RF.pop()}}}));

System.register("chunks:///_virtual/CameraFollow.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,i,o,r,n,s,a,l,f,p;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,o=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){n=e.cclegacy,s=e._decorator,a=e.Node,l=e.Vec3,f=e.math,p=e.Component}],execute:function(){var u,c,d,h,m,y,w,b,g,P,z,v,x;n._RF.push({},"41078GzJZ9I0r0kslqb6iM/","CameraFollow",void 0);e("CameraFollow",(u=s.ccclass("CameraFollow"),c=s.property({type:a}),d=s.property,h=s.property,m=s.property,y=s.property,u((g=t((b=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return t=e.call.apply(e,[this].concat(n))||this,o(t,"target",g,r(t)),o(t,"offset",P,r(t)),o(t,"sideOffsetFactor",z,r(t)),o(t,"smoothSpeed",v,r(t)),o(t,"maxSideOffset",x,r(t)),t.desiredPosition=new l,t.smoothedPosition=new l,t}return i(t,e),t.prototype.update=function(e){if(this.target){var t=this.target.worldPosition,i=this.target.worldRotation,o=new l;i.getEulerAngles(o);var r=o.y,n=new l,s=f.clamp(r/45,-1,1);n.x=-s*this.maxSideOffset;new l(this.offset.x+n.x,this.offset.y,this.offset.z);l.transformQuat(this.desiredPosition,this.offset,i),l.add(this.desiredPosition,this.desiredPosition,t),this.smoothedPosition.lerp(this.desiredPosition,this.smoothSpeed*e),this.node.worldPosition=this.smoothedPosition;var a=new l(t.x,t.y+1,t.z);this.node.lookAt(a)}},t}(p)).prototype,"target",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(b.prototype,"offset",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l(0,3,-5)}}),z=t(b.prototype,"sideOffsetFactor",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),v=t(b.prototype,"smoothSpeed",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),x=t(b.prototype,"maxSideOffset",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),w=b))||w));n._RF.pop()}}}));

System.register("chunks:///_virtual/CarController.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,i,n,o,a,s,p,l,u,c,g,h,d,y,m,f;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,i=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){o=e.cclegacy,a=e._decorator,s=e.RigidBody,p=e.Node,l=e.SpriteFrame,u=e.input,c=e.Input,g=e.KeyCode,h=e.math,d=e.Vec3,y=e.Quat,m=e.Sprite,f=e.Component}],execute:function(){var S,b,w,F,v,B,z,N,E,A,k,C,x,D,I,K,T,_,R,Y,M,L,P,U,O,W,H,V,Q,j,q,Z,G,J,X,$,ee,te,re;o._RF.push({},"57df0hk2QhNIqQ9WAAt5mD+","CarController",void 0);e("CarController",(S=a.ccclass("CarController"),b=a.property({type:s}),w=a.property({displayName:"Max Speed",min:0}),F=a.property({displayName:"Acceleration",min:0}),v=a.property({displayName:"Deceleration",min:0}),B=a.property({displayName:"Steering Force",min:0}),z=a.property({displayName:"Max Steering Angle",min:0,max:45}),N=a.property({displayName:"Steering Responsiveness",min:.1,max:1}),E=a.property({displayName:"Drag",min:0}),A=a.property({displayName:"Down Force",min:0}),k=a.property({type:p,displayName:"End Screen"}),C=a.property({type:p,displayName:"Forward Button"}),x=a.property({type:p,displayName:"Backward Button"}),D=a.property({type:p,displayName:"Left Button"}),I=a.property({type:p,displayName:"Right Button"}),K=a.property({type:[l],displayName:"Forward Frames [Normal, Pressed]"}),T=a.property({type:[l],displayName:"Stop Frames [Normal, Pressed]"}),_=a.property({type:[l],displayName:"Left Frames [Normal, Pressed]"}),R=a.property({type:[l],displayName:"Right Frames [Normal, Pressed]"}),S((L=t((M=function(e){function t(){for(var t,r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return t=e.call.apply(e,[this].concat(o))||this,i(t,"rigidBody",L,n(t)),i(t,"maxSpeed",P,n(t)),i(t,"acceleration",U,n(t)),i(t,"deceleration",O,n(t)),i(t,"steeringForce",W,n(t)),i(t,"maxSteeringAngle",H,n(t)),i(t,"steeringResponsiveness",V,n(t)),i(t,"drag",Q,n(t)),i(t,"downForce",j,n(t)),i(t,"endScreen",q,n(t)),i(t,"buttonF",Z,n(t)),i(t,"buttonB",G,n(t)),i(t,"buttonL",J,n(t)),i(t,"buttonR",X,n(t)),i(t,"forwardFrames",$,n(t)),i(t,"backwardFrames",ee,n(t)),i(t,"leftFrames",te,n(t)),i(t,"rightFrames",re,n(t)),t.currentSpeed=0,t.currentSteering=0,t.targetSteeringInput=0,t.isAccelerating=!0,t.isBraking=!1,t.isStop=!1,t.isFinalScreenShown=!1,t}r(t,e);var o=t.prototype;return o.onLoad=function(){var e=this;u.on(c.EventType.KEY_DOWN,this.onKeyDown,this),u.on(c.EventType.KEY_UP,this.onKeyUp,this),this.setupTouchButtons(),setTimeout((function(){return e.isAccelerating=!1}),1e3),this.isFinalScreenShown,setTimeout((function(){e.isFinalScreenShown=!0,e.endScreen.active=!0,e.isStop=!0,e.isAccelerating=!1,e.isBraking=!1}),4e4)},o.onTriggerEnter=function(e){var t=e.selfCollider.node;console.log("Машина вошла в триггер:",t.name)},o.onDestroy=function(){u.off(c.EventType.KEY_DOWN,this.onKeyDown,this),u.off(c.EventType.KEY_UP,this.onKeyUp,this),this.setupTouchButtons()},o.setupTouchButtons=function(){var e=this,t=function(t,r,i,n){if(console.log(r,t),t&&r[0]&&r[1]){var o=t.getComponent(m);o?(console.log("S",o),o.spriteFrame=r[0],t.on(p.EventType.TOUCH_START,(function(e){o.spriteFrame=r[1],i(),e.propagationStopped=!0}),e),t.on(p.EventType.TOUCH_END,(function(e){o.spriteFrame=r[0],n(),e.propagationStopped=!0}),e),t.on(p.EventType.TOUCH_CANCEL,(function(e){o.spriteFrame=r[0],n(),e.propagationStopped=!0}),e)):console.error("Sprite component missing on button:",t.name)}else console.warn("Button or frames missing:",null==t?void 0:t.name)};t(this.buttonF,this.forwardFrames,(function(){return e.isAccelerating=!0}),(function(){return e.isAccelerating=!1})),t(this.buttonB,this.backwardFrames,(function(){return e.isBraking=!0}),(function(){return e.isBraking=!1})),t(this.buttonL,this.leftFrames,(function(){1!==e.targetSteeringInput&&(e.targetSteeringInput=1)}),(function(){1===e.targetSteeringInput&&(e.targetSteeringInput=0)})),t(this.buttonR,this.rightFrames,(function(){-1!==e.targetSteeringInput&&(e.targetSteeringInput=-1)}),(function(){-1===e.targetSteeringInput&&(e.targetSteeringInput=0)}))},o.onKeyDown=function(e){switch(e.keyCode){case g.KEY_W:this.isAccelerating=!0;break;case g.KEY_S:this.isBraking=!0;break;case g.KEY_A:this.targetSteeringInput=1;break;case g.KEY_D:this.targetSteeringInput=-1}},o.onKeyUp=function(e){switch(e.keyCode){case g.KEY_W:this.isAccelerating=!1;break;case g.KEY_S:this.isBraking=!1;break;case g.KEY_A:1===this.targetSteeringInput&&(this.targetSteeringInput=0);break;case g.KEY_D:-1===this.targetSteeringInput&&(this.targetSteeringInput=0)}},o.update=function(e){if(!this.isFinalScreenShown&&this.node.worldPosition.z>500&&(this.isFinalScreenShown=!0,console.log("END",this.node.worldPosition),this.isStop=!0,this.isAccelerating=!1,this.isBraking=!1,this.endScreen.active=!0),this.currentSteering=h.lerp(this.currentSteering,this.targetSteeringInput,this.steeringResponsiveness*e*10),this.isAccelerating&&!this.isStop?this.currentSpeed=Math.min(this.currentSpeed+this.acceleration*e,this.maxSpeed):this.isBraking&&!this.isStop?this.currentSpeed=Math.max(this.currentSpeed-this.deceleration*e,-this.maxSpeed/2):this.isStop?this.currentSpeed>0?this.currentSpeed=Math.max(this.currentSpeed-3*this.deceleration*e,-this.maxSpeed/2):this.currentSpeed=0:Math.abs(this.currentSpeed),Math.abs(this.currentSpeed)>.1){var t=this.node.forward.clone().multiplyScalar(-this.currentSpeed);this.rigidBody.setLinearVelocity(new d(t.x,0,t.z))}if(0!==this.currentSteering&&Math.abs(this.currentSpeed)>.1&&!this.isStop){var r=h.toRadian(this.maxSteeringAngle)*this.currentSteering,i=Math.sin(r)*this.currentSpeed*this.steeringForce,n=this.node.right.clone(),o=this.node.forward.clone(),a=n.multiplyScalar(-i*e*100);this.rigidBody.applyForce(a,o)}this.applyDownForce(),this.stabilizeCar(e)},o.applyDownForce=function(){var e=-this.downForce*Math.abs(this.currentSpeed),t=new d(0,e,0);this.rigidBody.applyForce(t,d.ZERO)},o.stabilizeCar=function(e){var t=this.rigidBody.angularVelocity,r=5*e,i=new d(t.x*(1-r),t.y*(1-.5*r),t.z*(1-r));this.rigidBody.setAngularVelocity(i);var n=this.node.rotation,o=n.getEulerAngles(new d);o.x=h.lerp(o.x,0,5*e),o.z=h.lerp(o.z,0,5*e),y.fromEuler(n,o.x,o.y,o.z)},t}(f)).prototype,"rigidBody",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P=t(M.prototype,"maxSpeed",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),U=t(M.prototype,"acceleration",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),O=t(M.prototype,"deceleration",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 8}}),W=t(M.prototype,"steeringForce",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),H=t(M.prototype,"maxSteeringAngle",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 30}}),V=t(M.prototype,"steeringResponsiveness",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),Q=t(M.prototype,"drag",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.9}}),j=t(M.prototype,"downForce",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),q=t(M.prototype,"endScreen",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=t(M.prototype,"buttonF",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=t(M.prototype,"buttonB",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=t(M.prototype,"buttonL",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=t(M.prototype,"buttonR",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=t(M.prototype,"forwardFrames",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ee=t(M.prototype,"backwardFrames",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),te=t(M.prototype,"leftFrames",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),re=t(M.prototype,"rightFrames",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Y=M))||Y));o._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./AICar.ts","./CameraFollow.ts","./CarController.ts"],(function(){return{setters:[null,null,null],execute:function(){}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});